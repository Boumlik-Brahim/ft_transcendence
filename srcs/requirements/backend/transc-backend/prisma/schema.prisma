// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//* ---------------------------------------------------------------------------------------------------------------------------- *//

enum FriendShipStatus {
  PENDING
  ACCEPTED
}

enum Status {
  ONLINE
  OFFLINE
  INAGAME
}

enum ChannelType {
  PUBLIC
  PROTECTED
  PRIVATE
}

enum Role {
  OWNER
  ADMIN
  MEMBER
  MUTED_MEMBER
  BANNED_MEMBER
}

//* ---------------------------------------------------------------------------------------------------------------------------- *//

model User {
  id  String @id @default(uuid())
  name  String?
  email String @unique
  IntraId String @unique
  Avatar  String?
  status  Status @default(ONLINE)
  twoFa   Boolean @default(true)
  isAuth  Boolean @default(true)
  userStat  UserStat[]
  achievement Achievement[]
  userThatBlock BlockedUser[] @relation("Bloking")
  blockedUser   BlockedUser[] @relation("blocked")
  user    Friend[]  @relation("user")
  friend  Friend[]  @relation("friend")
  senders   DirectMessage[] @relation("sendeMessage")
  receivers DirectMessage[] @relation("receiveMessage")
  channel Channel[]
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
}

model UserStat {
  id  String @id @default(uuid())
  winsNumbr  Int
  lossesNumbr  Int
  rate  Int
  user  User  @relation(fields: [userId], references: [id])
  userId  String @unique
  created_at  DateTime  @default(now())
}

model Achievement {
  id  String @id @default(uuid())
  achievement String
  user  User @relation(fields: [userId], references: [id])
  userId  String @unique
  created_at  DateTime  @default(now())
}

model BlockedUser {
  id  String @id @default(uuid())
  userThatBlock User @relation("Bloking", fields: [userId], references: [id])
  userId  String @unique
  blockedUser User  @relation("blocked", fields: [blockedUserId], references: [id])
  blockedUserId String
  created_at  DateTime  @default(now())
}

model Friend {
  id  String @id @default(uuid())
  friendShipStatus FriendShipStatus
  user  User  @relation("user", fields: [userId], references: [id])
  userId  String
  friend  User  @relation("friend", fields: [friendId], references: [id])
  friendId  String
  created_at  DateTime  @default(now())
  @@unique([userId, friendId], name: "userAndFriend")
}

model DirectMessage {
  id  String @id @default(uuid())
  content String
  sender  User  @relation("sendeMessage", fields: [senderId], references: [id])
  senderId String
  reciever  User  @relation("receiveMessage", fields: [recieverId], references: [id])
  recieverId  String
  created_at  DateTime  @default(now())
}

//* ---------------------------------------------------------------------------------------------------------------------------- *//

model Channel {
  id  String @id @default(uuid())
  channelName String
  channelType ChannelType @default(PUBLIC)
  channelPassword String?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  channelOwnerId  String
  user  User[]
  channelMember ChannelMember[] @relation("channelMember")
  kickedMember  KickedMember[]  @relation("kickedMember")
  recievers  ChannelMessage[]  @relation("receiverRelation")
}

model ChannelMember {
  id  String @id @default(uuid())
  userId  String
  channel Channel @relation("channelMember", fields: [channelId], references: [id])
  channelId String
  sender  ChannelMessage[]  @relation("senderRelation")
  role Role @default(MEMBER)
  bannedTime DateTime?
  mutedTime DateTime?
  created_at  DateTime  @default(now())
  @@unique([userId, channelId], name: "userAndChannel")
}

model KickedMember {
  id  String @id @default(uuid())
  userId  String
  channel Channel @relation("kickedMember", fields: [channelId], references: [id])
  channelId String
  created_at  DateTime  @default(now())
  @@unique([userId, channelId], name: "kickedMemberAndChannel")
}

model ChannelMessage {
  id  String @id @default(uuid())
  content String
  sender  ChannelMember @relation("senderRelation", fields: [memberId], references: [id])
  memberId  String
  recievers  Channel @relation("receiverRelation", fields: [channelId], references: [id])
  channelId String
  created_at  DateTime  @default(now())
  @@unique([memberId, channelId], name: "senderAndChannel")
}

//* ---------------------------------------------------------------------------------------------------------------------------- *//