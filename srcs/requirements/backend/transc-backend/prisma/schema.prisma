// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//* ---------------------------------------------------------------------------------------------------------------------------- *//

model User {
  id  String @id @default(uuid())
  name  String?
  email String
  password  String
  Avatar  String?
  Status  String
  created_at  DateTime?  @default(now())
  userStat  UserStat[]
  achievement Achievement[]
  userThatBlock BlockedUser[] @relation("Bloking")
  blockedUser   BlockedUser[] @relation("blocked")
  user    Friend[]  @relation("user")
  friend  Friend[]  @relation("friend")
  senders   DirectMessage[] @relation("sendeMessage")
  receivers DirectMessage[] @relation("receiveMessage")
  channel Channel[]
  player  Game[]  @relation("player")
  openent Game[]  @relation("openent")
}

model UserStat {
  id  String @id @default(uuid())
  winsNumbr  Int
  lossesNumbr  Int
  rate  Int
  user  User  @relation(fields: [userId], references: [id])
  userId  String
}

model Achievement {
  id  String @id @default(uuid())
  achievement String
  created_at  DateTime  @default(now())
  user  User @relation(fields: [userId], references: [id])
  userId  String
}

model BlockedUser {
  id  String @id @default(uuid())
  userThatBlock User @relation("Bloking", fields: [userId], references: [id])
  userId  String
  blockedUser User  @relation("blocked", fields: [blockedUserId], references: [id])
  blockedUserId String
}

model Friend {
  id  String @id @default(uuid())
  created_at  DateTime  @default(now())
  friendShipStatus String[]
  user  User  @relation("user", fields: [userId], references: [id])
  userId  String
  friend  User  @relation("friend", fields: [friendId], references: [id])
  friendId  String
}

model DirectMessage {
  id  String @id @default(uuid())
  content String
  created_at  DateTime  @default(now())
  sender  User  @relation("sendeMessage", fields: [senderId], references: [id])
  senderId String
  reciever  User  @relation("receiveMessage", fields: [recieverId], references: [id])
  recieverId  String
}

//* ---------------------------------------------------------------------------------------------------------------------------- *//

model Channel {
  id  String @id @default(uuid())
  channelName String
  channelType String
  channelPassword String?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  channelOwnerId  String
  user  User[]
  channelMember ChannelMember[] @relation("channelMember")
  kickedMember  KickedMember[]  @relation("kickedMember")
  recievers  ChannelMessage[]  @relation("receiverRelation")
}

model ChannelMember {
  id  String @id @default(uuid())
  userId  String
  channel Channel @relation("channelMember", fields: [channelId], references: [id])
  channelId String
  sender  ChannelMessage[]  @relation("senderRelation")
  isAdmin Boolean @default(false)
  isBanned Boolean @default(false)
  bannedTime DateTime
  isMuted Boolean @default(false)
  mutedTime DateTime
  created_at  DateTime  @default(now())
  @@unique([userId, channelId], name: "userAndChannel")
}

model KickedMember {
  id  String @id @default(uuid())
  userId  String
  channel Channel @relation("kickedMember", fields: [channelId], references: [id])
  channelId String
  created_at  DateTime  @default(now())
  @@unique([userId, channelId], name: "kickedMemberAndChannel")
}

model ChannelMessage {
  id  String @id @default(uuid())
  content String
  sender  ChannelMember @relation("senderRelation", fields: [memberId], references: [id])
  memberId  String
  recievers  Channel @relation("receiverRelation", fields: [channelId], references: [id])
  channelId String
  created_at  DateTime  @default(now())
  @@unique([memberId, channelId], name: "senderAndChannel")
}

//* ---------------------------------------------------------------------------------------------------------------------------- *//

model Game {
  id  String @id @default(uuid())
  gameType  String
  gameStat  String[]
  created_at  DateTime  @default(now())
  player  User  @relation("player", fields: [player1Id], references: [id])
  player1Id String
  openent User  @relation("openent", fields: [player2Id], references: [id])
  player2Id String
}

//* ---------------------------------------------------------------------------------------------------------------------------- *//